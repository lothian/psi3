#
# CINTS Makefile
#
# Edward Valeev, Fake-New-Millenium-Eve
#
# Edit this list of subdirectories whose content
# to be included in CINTS to suit your needs. Valid subdirs are:
# 1. Default_Ints
# 2. OEProp_Ints
# 3. Fock
# 4. MP2
# 5. Default_Deriv1
# 6. MP2R12
# 7. R12_Ints
#
SUBDIRS = Default_Ints OEProp_Ints Fock MP2 Default_Deriv1

#
# Some subdirectories are not completely independent - need to perform
# additional "dependency" checks:
# 1. if R12_Ints included - make sure MP2R12 is included also.
# 2. if Fock (DFT) is included - include DFT (Fock) as well.
#
ifeq ($(findstring R12_Ints,$(SUBDIRS)),R12_Ints)
  ifeq ($(findstring MP2R12,$(SUBDIRS)),)
    SUBDIRS += MP2R12
  endif
endif
ifeq ($(findstring Fock,$(SUBDIRS)),Fock)
  ifeq ($(findstring DFT,$(SUBDIRS)),)
     SUBDIRS += DFT
  endif
else
  ifeq ($(findstring DFT,$(SUBDIRS)),DFT)
     SUBDIRS += Fock
  endif
endif

#
# Most subdirectories include code that requires some "integrals"
# library, like the notorious libint, which is always included.
# Here we test SUBDIRS for presence of such
# and form the list of the libraries. Remember that libderiv and libr12
# depend on libint, and hence need to come first for GNU ld to work.
#
INTLIBS := -lint
ifeq ($(findstring MP2R12,$(SUBDIRS)),MP2R12)
  ifneq ($(findstring -lr12,$(INTLIBS)),-lr12)
    INTLIBS := -lr12 $(INTLIBS)
  endif
endif
ifeq ($(findstring R12_Ints,$(SUBDIRS)),R12_Ints)
  ifneq ($(findstring -lr12,$(INTLIBS)),-lr12)
    INTLIBS := -lr12 $(INTLIBS)
  endif
endif
ifeq ($(findstring Default_Deriv1,$(SUBDIRS)),Default_Deriv1)
  ifneq ($(findstring -lderiv,$(INTLIBS)),-lderiv)
    INTLIBS := -lderiv $(INTLIBS)
  endif
endif

#
# These preprocessor defines will tell main.c and parsing.c what 
#  sections of code to include
#
OPTIONS = $(SUBDIRS:%=-DINCLUDE_%)

#
# Tools will always be included
#
DIRS = Tools $(SUBDIRS)

srcdir = @srcdir@
VPATH = @srcdir@
VPATH += $(DIRS:%=$(srcdir)/%)

include ../MakeVars

#Need do remove -DAIX because I have a variable named AIX
CDEF_NOAIX = $(CDEF:-DAIX=)
CFLAGS = $(CDBG) $(COPT) $(CDEF_NOAIX) $(COTH) $(CINC)

CINC = -I$(srcdir) $(DIRS:%=-I$(srcdir)/%)  -I$(objincdir) -I$(incdir)
CDEF += $(OPTIONS)

LD = $(FC)
LDLIBS += $(BLAS)
ALLOC = 
PSILIBS = -lfile30 $(INTLIBS) -lqt -liwl \
          -lpsio -lciomr -lipv1 -lpthread 

CSRC = main.c parsing.c gprgid.c init_globals.c check_max_am.c $(DIRS:%=%/*.c)
TRUESRC = $(notdir $(shell echo `ls $(CSRC:%=$(srcdir)/%)`))

BINOBJ = $(TRUESRC:%.c=%.o)

include ../MakeRules

install:: install_html

install_man:: cints.1
	$(MKDIRS) $(mandir)/man1
	$(INSTALL_INCLUDE) $^ $(mandir)/man1

install_html:: install_index install_htmlsrc

install_index:: cints.html
	$(MKDIRS) $(htmldir)
	$(INSTALL_INCLUDE) $^ $(htmldir)

HTMLSRC = $(shell echo `ls $(srcdir)/Documentation/*.html`)
install_htmlsrc: $(HTMLSRC)
	$(MKDIRS) $(htmldir)/CINTS
	$(INSTALL_INCLUDE) $(HTMLSRC) $(htmldir)/CINTS
