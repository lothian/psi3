\subsubsection{Library Philosophy}
The \library{libfile30.a} library is a collection of functions used to
access the \PSIthree\ checkpoint file (\FILE{30}) -- the file which contains all
most frequently used information about the computation such as
molecular geometry, basis set, HF determinant, etc. Currently, the checkpoint file
is a fixed-format file which is accessed using the old \PSIthree\ I/O system.
However, this is going to change in the future: the new I/O system
will be used to access the checkpoint file, and it will become free format, i.e.
any programmer will be able to add content to the file at will.
We are planning to preserve the current interface for compatibility purposes.
Hence it is {\em mandatory} that the checkpoint file is accessed via the
\library{libfile30.a} functions {\em only}.
\footnote{Strictly speaking, the only \PSIthree\ module which may still use old I/O
functions directly is \PSIinput .}

Throughout this section we will use terms ``checkpoint file'' and ``\FILE{30}''
interchangeably, although in the future the actual file number of the checkpoint file
may change.

\subsubsection{Basic Use Instructions}
Following the philosophy that a programmer who wants to read, say,
the number of atoms and the irrep labels from \FILE{30} should not have to use
fifty lines of code to do so, \library{libfile30.a} was written.
Following a call to a
single command, \celem{file30\_init()}, the programmer can extract many useful bits
of info from \FILE{30} relatively painlessly. \library{libfile30.a} is dependant upon
\library{libipv1.a}, and requires that the input parser be initialized so that the
proper file name labels may be referenced.  An example of a minimal code
which sets up the input parser, initilizes a special structure within the
\library{libfile30.a} library, and reads the SCF HF energy, eigenvector and eigenvalues is
given below.  In order to illustrate the writing capability of the library
routines, a dummy correlated energy is written to \FILE{30} and then read out
again within the code.

\begin{verbatim}
#include <stdio.h>
#include <file30.h>
#include <libciomr.h>
#include <ip_libv1.h>
/*--- To future-proof the code initialize libpsio.a as well ---*/
#include <psio.h>

FILE *infile, *outfile;

void main(void)
{
 
  int nmo;

  double escf, ecorr;
  double *evals;
  double **scf;

  /*-------------------------------------
    initialize the input parser, read in
    the files information from the
    default section
   -------------------------------------*/
  ffile(&infile,"input.dat",2);
  ffile(&outfile,"output.dat",1);
  tstart(outfile);
  ip_set_uppercase(1);
  ip_initialize(infile,outfile);
  ip_cwk_clear();
  ip_cwk_add(":DEFAULT");

  /*--- To future-proof the code initialize libpsio.a as well ---*/
  psio_init();

  /*------------------------------------
    now initialize the file30 structure
    and begin reading info
   ------------------------------------*/
  file30_init();

  escf = file30_rd_escf();
  evals = file30_rd_evals();
  scf = file30_rd_scf();
  nmo = file30_rd_nmo();
 
  file30_wt_ecorr(-1000.0);
  
  ecorr = file30_rd_ecorr();

  file30_close();

  /*--------------------------------------------
    print out info to see what has been read in
   --------------------------------------------*/
  fprintf(outfile,"\n\n\tEscf  = %20.10lf\n",escf);
  fprintf(outfile,"\tEcorr = %20.10lf\n",ecorr);
  fprintf(outfile,"SCF EIGENVECTOR\n");

  eivout(scf,evals,nmo,nmo,outfile); 
  
  /*--- To future-proof the code initialize libpsio.a as well ---*/
  psio_done();
  
  tstop(outfile);
  ip_done();
 }

  /*-------------------------------------------------
    dont forget to add the obligatory gprgid section 
   -------------------------------------------------*/
char *gprgid()
{
   char *prgid = "TEST30";

   return(prgid);
}
\end{verbatim}

\subsubsection{Initialization}
\funcdesc{int file30\_init()}
{Initializes the \celem{file30} struct to allow other \celem{file30\_*}
functions to perform their duties.}{none, but it requires that
the input parser be initialized so that it can open \FILE{30}.}
{zero.  Perhaps this will change some day.} \\
\funcdesc{int file30\_close()} 
{Closes up file30, frees file30 struct.}
{none, but \celem{file30\_init} must already have been called for
this to work.}
{zero.  Perhaps this, too, will change one day.}

\subsubsection{Functions for reading information from the checkpoint file}
\begin{center}
Functions that return \celem{char*}
\end{center}
\funcdesc{char *file30\_rd\_corr\_lab()}
{Reads in a label from \FILE{30} which describes the
wavefunction used to get the correlated energy which is stored in
\FILE{30} (see \celem{file30\_rd\_ecorr()}).}
{takes no arguments.}
{a string, like "CISD", or "MCSCF" or
some other wavefunction designation.}\\
\funcdesc{char *file30\_rd\_label()}
{Reads the main \FILE{30} label.}
{takes no arguments.}
{calculation label.} \\
\funcdesc{char *file30\_rd\_sym\_label()}
{Reads the label for the point group.}
{takes no arguments.}
{point group label.}

\begin{center}
Functions that return \celem{char**}
\end{center}
\funcdesc{char **file30\_rd\_irr\_labs()} 
{Read in the symmetry labels for all irreps in the
point group in which the molecule is considered.}
{takes no arguments.}
{an array of labels (strings) which denote
the irreps for the point group  in which the molecule is considered,
\_regardless\_ of whether there exist any symmetry orbitals which
transform as that irrep.} \\
\funcdesc{char **file30\_rd\_hfsym\_labs()}
{Read in the symmetry labels \_only\_ for those irreps
which have basis functions.}
{takes no arguments.}
{an array of labels (strings) which denote
the irreps which have basis functions (in Cotton ordering).  For DZ or
STO-3G water, for example, in $C_{\rm 2v}$ symmetry, this would be an array of
three labels: "A1", "B1", and "B2".}

\begin{center}
Functions that return \celem{int}
\end{center}
\funcdesc{int file30\_rd\_iopen()}
{Reads in the dimensionality (up to a sign) of ALPHA and BETA vectors of 
two-electron coupling coefficients for open shells. (see \celem{file30\_rd\_ccvecs()})
Note : \celem{iopen} = MM * (MM + 1), where MM is the total number of
irreps containing singly occupied orbitals.}
{takes no arguments.}
{the +/- dimensionality of ALPHA and BETA vectors of 
coupling coefficients for open shells.} \\
\funcdesc{int file30\_rd\_max\_am()}
{Reads in the maximum orbital quantum number of AOs in the basis.}
{takes no arguments.}
{the maximum orbital quantum number of AOs in the basis.} \\
\funcdesc{int file30\_rd\_mxcoef()}
{Reads the value of the constant \celem{mxcoef}.}
{takes no arguments.}
{the sum of the squares of the number of symmetry
orbitals for each irrep.  This gives the number of elements in the
non-zero symmetry blocks of the SCF eigenvector.  For STO-3G water
\celem{mxcoef}$ = (4*4) + (0*0) + (1*1) + (2*2) = 21$.} \\
\funcdesc{int file30\_rd\_nao()}
{Reads in the total number of atomic orbitals (read: Cartesian Gaussian functions).}
{takes no arguments.}
{total number of atomic orbitals.} \\
\funcdesc{int file30\_rd\_natom()}
{Reads in the total number of atoms.}
{takes no arguments.}
{total number of atoms.} \\
\funcdesc{int file30\_rd\_ncalcs()}
{Reads in the total number of calculations (always 1).}
{takes no arguments.}
{total number of calculations in \FILE{30}.} \\
\funcdesc{int file30\_rd\_nirreps()}
{Reads in the total number of irreducible representations
in the point group in which the molecule is being considered.}
{takes no arguments.}
{total number of irreducible representations.} \\
\funcdesc{int file30\_rd\_nmo()}
{Reads in the total number of molecular orbitals (may be different
from the number of basis functions).}
{takes no arguments.}
{total number of molecular orbitals.} \\
\funcdesc{int file30\_rd\_nprim()}
{Reads in the total number of primitive Gaussian functions 
(only primitives of \_symmetry independent\_ atoms are counted!).}
{takes no arguments.}
{total number of primitive Gaussian functions.} \\
\funcdesc{int file30\_rd\_nshell()}
{Reads in the total number of shells. For example, DZP basis set for 
carbon atom (contraction scheme $[9s5p1d/4s2p1d]$) has a total of 15 basis 
functions, 15 primitives, and 7 shells. Shells of \_all\_ atoms are counted
(not only of the symmetry independent; compare \celem{file30\_rd\_nprim}).}
{takes no arguments.}
{total number of shells.} \\
\funcdesc{int file30\_rd\_nso()}
{Reads in the total number of symmetry-adapted basis functions (read:
Cartesian or Spherical Harmonic Gaussians).}
{takes no arguments.}
{total number of SOs.} \\
\funcdesc{int file30\_rd\_nsymhf()}
{Reads in the total number of irreps
in the point group in which the molecule is being considered which
have non-zero number of basis functions. For STO-3G or DZ water, for
example, this is three, even though \celem{nirreps} is 4 (compare
\celem{int file30\_rd\_nirreps()}).}
{takes no arguments.}
{total number of irreducible representations
with a non-zero number of basis functions.} \\
\funcdesc{int file30\_rd\_num\_unique\_atom()}
{Reads in the number of symmetry unique atoms.}
{takes no arguments.}
{number of symmetry unique atoms.} \\
\funcdesc{int file30\_rd\_num\_unique\_shell()}
{Reads in the number of symmetry unique shells.}
{takes no arguments.}
{number of symmetry unique shells.} \\
\funcdesc{int file30\_rd\_phase\_check()}
{Reads the phase flag???}
{takes no arguments.}
{flag.}
\funcdesc{int file30\_rd\_ref()}
{Reads the reference type from the flag in \FILE{30}.
0 = RHF, 1 = UHF, 2 = ROHF, 3 = TCSCF.}
{takes no arguments.}
{flag indicating the reference.}
\funcdesc{int file30\_rd\_rottype()}
{Reads the rigid rotor type the molecule represents.
0 = asymmetric, 1 = symmetric, 2 = spherical, 3 = linear, 6 = atom.}
{takes no arguments.}
{rigid rotor type.}

\begin{center}
Functions that return \celem{int*}
\end{center}
\funcdesc{int *file30\_rd\_am2canon\_shell\_order()}
{Reads in the the mapping array from the angmom-ordered
to the canonical (in the order of appearance) list of shells.}
{takes no arguments.}
{an array \celem{nshell} long that maps shells from the angmom-ordered
to the canonical (in the order of appearance) order.}
\funcdesc{file30\_rd\_atom\_position()}
{Reads in symmetry positions of atoms.
Allowed values are as follows:
\begin{itemize}
\item 1   - atom in a general position
\item 2   - atom on the c2z axis
\item 4   - atom on the c2y axis
\item 8   - atom on the c2x axis
\item 16  - atom in the inversion center
\item 32  - atom in the sigma\_xy plane
\item 64  - atom in the sigma\_xz plane
\item 128 - atom in the sigma\_yz plane
\end{itemize}
This data is sufficient to define stabilizers of the nuclei.}
{takes no arguments.}
{an array of symmetry positions of atoms.} \\
\funcdesc{int *file30\_rd\_clsdpi()}
{Reads in an array which has an element for each irrep of the
point group of the molecule (n.b. not just the ones
with a non-zero number of basis functions). Each element
contains the number of doubly occupied MOs for that irrep.}
{takes no arguments.}
{the number of doubly occupied MOs per irrep.} \\
\funcdesc{int *file30\_rd\_openpi()}
{Reads in an array which has an element for each irrep of the
point group of the molecule (n.b. not just the ones
with a non-zero number of basis functions).  Each element
contains the number of singly occupied MOs for that irrep.}
{takes no arguments.}
{the number of singly occupied MOs per irrep.} \\
\funcdesc{int *file30\_rd\_orbspi()}
{Reads in the number of MOs in each irrep.}
{takes no arguments.}
{the number of MOs in each irrep.} \\
\funcdesc{int *file30\_rd\_shells\_per\_am()}
{Reads in the number of shells in each angmom block.}
{takes no arguments.}
{the number of shells in each angmom block.} \\
\funcdesc{file30\_rd\_sloc()}
{Read in an array of pointers to the first AO
from each shell.}
{takes no arguments.}
{Read in an array \celem{nshell} long of pointers to
the first AO from each shell.} \\
\funcdesc{file30\_rd\_sloc\_new()}
{Read in an array of pointers to the first basis
function (not AO as \celem{file30\_rd\_sloc} does)
from each shell.}
{takes no arguments.}
{an array \celem{nshell} long of pointers to
the first basis function from each shell.} \\
\funcdesc{int *file30\_rd\_snuc()}
{Reads in an array of pointers to the nuclei on which shells are centered.}
{takes no arguments.}
{an array \celem{nshell} long of pointers to the nuclei on which shells
are centered.}
\funcdesc{int *file30\_rd\_snumg()}
{Reads in array of the numbers of the primitive
Gaussians in the shells.}
{takes no arguments.}
{an array \celem{nshell} long of the numbers of 
the primitive Gaussians in shells.} \\
\funcdesc{int *file30\_rd\_sprim()}
{Reads in pointers to the first primitive
from each shell.}
{takes no arguments.}
{an array \celem{nshell} long of pointers to the first 
primitive from each shells.} \\
\funcdesc{file30\_rd\_sopi()}
{Read in the number of symmetry-adapted basis functions in each symmetry block.}
{takes no arguments.}
{an array nirreps long of the numbers of
symmetry orbitals in symmetry blocks.} \\
\funcdesc{int *file30\_rd\_stype()}
{Reads in angular momentum numbers of
the shells.}
{takes no arguments.}
{Returns an array \celem{nshell} long of
the angular momentum numbers of the shells.} \\
\funcdesc{int *file30\_rd\_symoper()}
{Read in the mapping array between "canonical" ordering
of the symmetry operations of the point group and the
one defined in \file{symmetry.h}.}
{takes no arguments.}
{a mapping array \celem{nirrep} long}
\funcdesc{int *file30\_rd\_ua2a()}
{Read in the mapping array from the symmetry-unique atom 
list to the full atom list.}
{takes no arguments.}
{a mapping array \celem{num\_unique\_atom} long}
\funcdesc{int *file30\_rd\_us2s()}
{Read in the mapping array from the symmetry-unique shell list
to the full shell list.}
{takes no arguments.}
{a mapping array \celem{num\_unique\_shell} long}

\begin{center}
Functions that return \celem{int**}
\end{center}
\funcdesc{int **file30\_rd\_ict()}  
{Reads the transformation properties of the nuclei
under the operations allowed for the particular symmetry point group
in which the molecule is considered.}
{takes no arguments.}
{a matrix of integers. Each row corresponds
to a particular symmetry operation, while each column corresponds to
a particular atom.  The value of \celem{ict[2][1]}, then, should be interpreted
in the following manner: application of the third symmetry operation of 
the relavant point group, the second atom is placed in the location
originally occupied by the atom number \celem{ict[2][1]}.} \\
\funcdesc{int **file30\_rd\_shell\_transm()}
{Reads in the transformation matrix for the shells. Each row of the 
matrix is the orbit of the shell under symmetry operations of the point 
group.}
{takes no arguments.}
{a matrix of \celem{nshell}*\celem{nirreps} integers.}

\begin{center}
Functions that return \celem{double}
\end{center}
\funcdesc{double file30\_rd\_ecorr()}
{Reads in the correlation energy stored in file30. To get some
information (a label) on the type of correlated wavefunction
used to get this energy, see \celem{file30\_rd\_corr\_lab()}.}
{takes no arguments.}
{the correlation energy.} \\
\funcdesc{double file30\_rd\_enuc()}
{Reads in the nuclear repulsion energy}
{takes no arguments.}
{the nuclear repulsion energy.} \\
\funcdesc{double file30\_rd\_eref()}
{Reads in the reference energy (may be different from HF energy).}
{takes no arguments.}
{the reference energy.} \\
\funcdesc{double file30\_rd\_escf()}
{Reads in the SCF HF energy.}
{takes no arguments.}
{the SCF HF energy.}

\begin{center}
Functions that return \celem{double*}
\end{center}
\funcdesc{double *file30\_rd\_evals()\\
double *file30\_rd\_alpha\_evals()\\
double *file30\_rd\_beta\_evals()}
{Reads in the (spin-restricted HF, $\alpha$ UHF, and $\beta$ UHF) eigenvalues:
the orbital energies.}
{take no arguments.}
{an array of \_all\_ of the SCF eigenvalues,
ordered by irrep, and by increasing energy within each irrep.
(i.e. for STO-3G water, the four $a_1$ eigenvalues all come first, and
those four are ordered from lowest energy to highest energy,
followed by the single $b_1$ eigenvalue, etc. --- Pitzer ordering)} \\
\funcdesc{double *file30\_rd\_exps()}
{Reads in the exponents of the primitive Gaussian functions.}
{takes no arguments.}
{an array of doubles.} \\
\funcdesc{double *file30\_rd\_zvals()}
{Reads in nuclear charges.}
{takes no arguments.}
{an array natom long of nuclear charges (as doubles).}

\begin{center}
Functions that return \celem{double**}
\end{center}
\funcdesc{double **file30\_rd\_blk\_scf(int irrep)\\
double **file30\_rd\_alpha\_blk\_scf(int irrep)\\
double **file30\_rd\_beta\_blk\_scf(int irrep)}
{Reads in a symmetry block of 
the (RHF, $\alpha$ UHF, $\beta$ UHF) eigenvector.}
{\celem{int irrep}, designates the desired symmetry block}
{a square matrix has \celem{orbspi[irrep]}
rows.  The eigenvectors are stored with the column 
index denoting MOs and the row index denoting SOs: this means that 
\celem{scf\_vector[i][j]} is the contribution of the $i$th SO to the $j$th MO.} \\
\funcdesc{double **file30\_rd\_ccvecs()}
{Reads in a matrix rows of which are 
ALPHA (ccvecs[0]) and BETA (ccvecs[1]) matrices of coupling
coefficients for open shells stored in lower triangular form.
Coupling coefficients are defined NOT as in 
C.C.J.Roothaan Rev. Mod. Phys. {\bf 32}, 179 (1960) as it is stated in the
manual pages for CSCF, but according to Pitzer (no reference yet)
and are **different** from those in Yamaguchi, Osamura, Goddard, and
Schaefer's book "Analytic Derivative Methods in Ab Initio Molecular
Electronic Structure Theory".\\
The relationship between the Pitzer's and Yamaguchi's conventions is 
as follows : ALPHA = 1-2*a , BETA = 1+4*b , where a and b are 
alpha's and beta's for open shells 
defined on pp. 69-70 of Dr. Yamaguchi's book.
}
{takes no arguments.}
{double **ccvecs, a matrix 2 by \celem{abs(iopen)} rows of which are coupling
coefficient matrices for open-shells in packed form.
For definition of \celem{iopen} see file30\_rd\_iopen().} \\
\funcdesc{file30\_rd\_contr\_full()}
{Reads in the normalized contraction coefficients.}
{takes no arguments.}
{a matrix \celem{MAXANGMOM} (a constant defined in \file{file30\_params.h})
by the total number of primitives \celem{nprim};
each primitive Gaussian contributes to only one shell (and one
basis function, of course), so most of these values are zero.} \\
\funcdesc{double **file30\_rd\_geom()}
{Reads in the cartesian geometry.}
{takes no arguments.}
{The cartesian geometry is returned as a matrix
of doubles.  The row index is the atomic index, and the column is the
cartesian direction index (x=0, y=1, z=2).  Therefore, \celem{geom[2][0]}
would be the x-coordinate of the third atom.} \\
\funcdesc{file30\_rd\_lagr()\\
file30\_rd\_alpha\_lagr()\\
file30\_rd\_beta\_lagr()}
{Reads in an (RHF, $\alpha$ UHF, $\beta$ UHF) Lagrangian matrix in MO basis.}
{takes no arguments.}
{a matrix \celem{nmo} by \celem{nmo}.} \\
\funcdesc{double **file30\_rd\_scf()\\
double **file30\_rd\_alpha\_scf()\\
double **file30\_rd\_beta\_scf()}
{Reads in the (RHF, $\alpha$ UHF, $\beta$ UHF) eigenvector.}
{takes no arguments.}
{a square matrix of dimensions \celem{nmo}
by \celem{nmo} (see: \celem{file30\_rd\_nmo()}).
The symmetry blocks of the SCF vector appear
on the diagonal of this matrix.} \\
\funcdesc{file30\_rd\_schwartz()}
{Reads in the table of maxima of Schwartz integrals (ij|ij)
for each shell doublet.}
{takes no arguments.}
{\celem{NULL} if no table is present in the checkpoint file,
a matrix \celem{nshell} by \celem{nshell} otherwise.} \\
\funcdesc{file30\_rd\_usotao\_new()}
{Reads in an AO to SO transformation matrix.}
{takes no arguments.}
{a \celem{nso} by \celem{nao} matrix of doubles.} \\
\funcdesc{file30\_rd\_usotbf()}
{Reads in a basis function to SO transformation matrix.}
{takes no arguments.}
{a \celem{nso} by \celem{nso} matrix of doubles.}
