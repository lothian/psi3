\subsection{Geometry Specification}
Full molecular geometry has to be specified in form of Cartesian coordinates or
a Z-matrix. Cartesian coordinates of atoms are specified via a keyword
\keyword{geometry} which has to be a member of either \keyword{default}
or \keyword{input} sections:
\begin{verbatim}
  geometry = (
    (atomname1 x1 y1 z1)
    (atomname2 x2 y2 z2)
    (atomname3 x3 y3 z3)
        ..........
    (atomnameN xN yN zN)
  )
\end{verbatim}
where \keyword{atomname$i$} can take the following values:
\begin{itemize}
\item element symbol (H, He, Li, Be, B, etc.);
\item full element name (hydrogen, helium, lithium, etc.);
\item {\em ghost} atom symbol (G) or name (ghost). Ghost atom is an atom
of formal charge 0.0, it can be useful to specify the location of
the off-nucleus basis functions;
\item {\em dummy} atom symbol (X). Dummy atoms can be useful only to specify
Z-matrices of proper symmetry (not used in \PSIthree; see below) or
which contain linear fragments.
\end{itemize}
Hence the following two examples are equivalent to one another:
\begin{verbatim}
  geometry = (
    (H 0.0 0.0 0.0)
    (f 1.0 0.0 0.0)
    (Li 3.0 0.0 0.0)
    (BE 6.0 0.0 0.0)
  )
\end{verbatim}
\begin{verbatim}
  geometry = (
    (hydrogen  0.0 0.0 0.0)
    (FLUORINE  1.0 0.0 0.0)
    (Lithium   3.0 0.0 0.0)
    (berillium 6.0 0.0 0.0)
  )
\end{verbatim}

The keyword \keyword{units} specifies the units for the coordinates:
\begin{itemize}
\item \keyword{units = bohr} -- atomic units (Bohr), default;
\item \keyword{units = angstrom} -- angstroms ($\AA$);
\end{itemize}

The \keyword{zmat} keyword can be used to specify a Z-matrix for the molecule.
It also has to be put in either \keyword{default} or \keyword{input} sections.
The format of this vector is as follows:
\begin{verbatim}
  zmat = (
    (atomname1)
    (atomname2 ref21 bond_dist2)
    (atomname3 ref31 bond_dist3 ref32 bond_angle3)
    (atomname4 ref41 bond_dist4 ref42 bond_angle4 ref43 tors_angle4)
    (atomname5 ref51 bond_dist5 ref52 bond_angle5 ref53 tors_angle5)
                     ...........................
    (atomnameN refN1 bond_distN refN2 bond_angleN refN3 tors_angleN)
  )
\end{verbatim}
where
\begin{itemize}
\item \keyword{bond\_dist$i$} is the distance (in units specified by
keyword \keyword{units}) from nucleus number $i$ to
nucleus number \keyword{ref$i$1}. The units 
\item \keyword{bond\_angle$i$} is the angle formed by nuclei $i$,
\keyword{ref$i$1}, and \keyword{ref$i$2};
\item \keyword{tors\_angle$i$} is the torsion angle formed by nuclei $i$,
\keyword{ref$i$1}, \keyword{ref$i$2}, and \keyword{ref$i$3};
\end{itemize}
Some care has to be taken when constructing a Z-matrix for a molecule
which contains linear fragments. For example, let's construct a Z-matrix
for a linear conformation of HNCO. The first three atoms (HNC) can be specified
as is, but the fourth atom (O) poses a problem -- the torsional angle cannot be
defined with respect to the linear HNC fragment. The solution is to add
2 dummy atoms to the definition:
\begin{verbatim}
  zmat = (
    (h)
    (n 1 1.012)
    (x 2 1.000 1  90.0)
    (c 2 1.234 3  90.0 1 180.0)
    (x 4 1.000 2  90.0 3 180.0)
    (o 4 1.114 5  90.0 2 180.0)
  )
\end{verbatim}

Of course, a choice of the method for geometry specification is solely
a matter of convenience.

\subsection{Molecular Symmetry}
\PSIthree\ can determine automatically the largest Abelian point group
for a valid framework of centers (the framework also includes ghost
atoms, but it does not include dummy atoms).
It will then use the symmetry porperties of the system in computing energy,
forces, and other properties.
However, in certain instances it is desirable to use a lower than the
full symmetry. The keyword \keyword{subgroup} is used to specify a subgroup of
the full molecular point group. The allowed values are \keyword{c2v},
\keyword{c2h}, \keyword{d2}, \keyword{c2}, \keyword{cs}, \keyword{ci},
and \keyword{c1}. For certain combinations of a group and
its subgroup there is no unique way to determine which subgroup is
implied. For example, $D_{\rm 2h}$ has 3 non-equivalent $C_{\rm 2v}$ subgroups,
e.g. $C_{\rm 2v}(X)$ consists of symmetry operations $\hat{E}$, $\hat{C}_2(x)$,
$\hat{\sigma}_{xy}$, and $\hat{\sigma_{xz}}$. 
To specify subgroups precisely one has to use the \keyword{unique\_axis}
keyword. E.g. the following input will specify the $C_{\rm 2v}(X)$
subgroup of $D_{\rm 2h}$ to be the computational point group:
\begin{verbatim}
  input: (
    geometry = (
      ........
    )
    units = angstrom
    subgroup = c2v
    unique_axis = x
  )
\end{verbatim}

\subsection{Basis Sets}
\PSIthree\ uses basis sets comprised of Cartesian (\keyword{puream = false}, default)
or Spherical Harmonic (\keyword{puream = true}) Gaussian basis functions.
An atomic basis set is normally identified by a string. Currently, there exist
three ways to specify which basis sets to use for which atoms:
\begin{itemize}
\item \keyword{basis = string} -- all atoms use basis set type
\keyword{string};
\item \keyword{basis = (string1 string2 string3 ... stringN)} -- \keyword{string$i$}
specifies the basis set for atom $i$. Thus, the number of strings in the \keyword{basis}
vector has to be the same as the number of atoms (including ghost atoms but excluding
dummy atoms). Another restriction is that symmetry equivalent atoms should have
same basis sets, otherwise \PSIinput\ will use the string provided for the so-called
unique atom out of the set of symmetry equivalent ones.
\item 
\begin{verbatim}
  basis = (
    (element1 string1)
    (element2 string2)
       ...........
    (elementN stringN)
  )
\end{verbatim}
\keyword{string$i$} specifies the basis set for chemical element \keyword{element$i$}.
\end{itemize}

\subsubsection{Default Basis Sets}
\PSIthree\ default basis sets are located in \pbasisdat\ which is located in
{\tt \$psipath/share}. Table \ref{table:basisset} lists basis sets defined in \pbasisdat.
\begin{table}
\caption{Summary of basis sets defined in \PSIthree.}
\label{table:basisset}
\begin{tabular}{lll} \hline\hline 
Basis Sets & ID string & Elements \\ \hline
cc-pV$x$Z & ccpv$x$z & H, Be-Ne \\
\hline\hline
\end{tabular}
\end{table}

\subsubsection{Custom Basis Sets}
To make a custom basis set, enter the information in either of the following four files:
\begin{itemize}
\item \pbasisdat\ -- only if you think it should be added to \PSIthree. You also
might want to check in your additions and changes so that everyone could
benefit from them. Refer to the \PSIthree\ Programmer's Manual for information
on how to access \PSIthree\ repository.
\item An arbitrary text file. To specify the file's location use keyword
\keyword{basisfile}:
\begin{verbatim}
  input: (
    % The meaning of this is pretty obvious
    basisfile = "/home/users/tool/chem/h2o/mybasis.in"
    % If the location ends with '/', "basis.dat" is automatically appended
    % Hence this specifies /home/users/tool/chem/basis.dat !
    basisfile = "/home/users/tool/chem/"
  )
\end{verbatim}
Use this option if you want to use the basis set file in a project
which involves running more than one computation.
\item File named \basisdat, which resides in the working directory along with \inputdat .
Same use as the previous entry.
\item \inputdat
\end{itemize}
The order in which \PSIinput\ program searches for basis sets is the order in which files
appear in our checklist.

A contracted Cartesian Gaussian-Type Orbital
\begin{eqnarray}
\phi_{\rm CGTO} & = & x^ly^mz^n\sum_i C_i \exp(-\alpha_i[x^2+y^2+z^2])
\end{eqnarray}
where
\begin{eqnarray}
L & = & l+m+n
\end{eqnarray}
is written as
\begin{verbatim}
basis: (
  ATOM_NAME: "BASIS_SET_LABEL" = (
    (L (C1  alpha1)
       (C2  alpha2)
       (C3  alpha3)
       ...
       (Cn  alpha4))   
    )
  )
\end{verbatim}

\subsection{Electronic Structure Specification}
The reference electronic configuration of a molecule is specified
via a combination of keywords \keyword{reference} and \keyword{multiplicity}
and occupation vectors \keyword{docc} and \keyword{socc}. However, the latter
may not be necessary as \PSIcscf\ may guess occupations (\keyword{docc}
and \keyword{socc} arrays) for you
had \keyword{charge}, \keyword{multiplicity}, and \keyword{reference}
have been specified. It is the easiest way to specify electronic configuration
for your system, but remember that guessing algorithms \PSIcscf\ uses are
far from perfect. Hence you should check guessed occupations every time you
let \PSIcscf\ guess them for you.

To determine the electronic occupations in \PSIthree\ manually, first
construct symmetry
orbitals using group theory and fill them according to regular
valence bond arguments. To define your occupations in \PSIthree,
use the \keyword{docc} and \keyword{socc} arrays. But only \keyword{docc}
and \keyword{socc} may not be enough to specify precisely
the spin couplings in your system. That's where \keyword{reference} and
\keyword{multiplicity} keywords come in. \keyword{multiplicity} is equal
2S+1, where S is the spin quantum number of the system. \keyword{reference} can equal 
\begin{itemize}
\item rhf (default) - spin-restricted reference for closed shell molecules.
\keyword{multiplicity} may only equal to 1 in this case.
\item rohf - spin-restricted reference for open shell molecules.
If multiplicity=1 and socc has two singly occupied orbitals in
different symmetry blocks - it's equivalent to the old opentype=singlet statement.
Otherwise it's assumed to be a high-spin open-shell case
(equivalent to the old opentype=highspin statement).
\item uhf - spin-unrestricted reference for closed shell or high-spin (parallel spins) open shell system.
\item twocon for two determinantal wavefunctions. The largest
component should be specified by the docc and socc arrays.
Multiplicity has to be set to 1.
\end{itemize}
For $^1{\rm A}_1$ methylene, the occupation is (1a1)2(2a1)2(1b2)1(3a1)2 so the docc is: 
\begin{verbatim}
reference = rhf or uhf
multiplicity = 1
docc = (3 0 0 1)
\end{verbatim}
For the $^3{\rm B}_1$ state of methylene,
the electronic configuration is (1a1)2(2a1)2(1b2)2(3a1)1(1b1)1 so the docc and socc arrays are: 
\begin{verbatim}
reference = rohf or uhf
multiplicity = 3
docc = (2 0 0 1)
socc = (1 0 1 0)
\end{verbatim}
For the $^1{\rm B}_1$ state of methylene however, the docc and socc arrays are also: 
\begin{verbatim}
reference = rohf
multiplicity = 1
docc = (2 0 0 1)
socc = (1 0 1 0)
\end{verbatim}
Since most of the basis sets are highly contracted in the core regions,
core electrons are routinely frozen and corresponding virtual
orbitals are deleted. This is accomplished via the \keyword{frozen\_docc}
and \keyword{frozen\_uocc} arrays. Simply specify the symmetry of
the frozen orbital and \PSIthree\ will do the rest. 

To freeze the lowest $a_1$ orbital and delete the corresponding
highest $b_2$ orbital, they would look like this: 
\begin{verbatim}
frozen_docc = (1 0 0 0)
frozen_uocc = (0 0 0 1)
\end{verbatim}

\subsection{Single-Point Energy Computation}
Along with the wavefunction type, the nuclear framework, basis set,
and electronic configuration are sufficient
for a single-point evaluation of the electronic energy.
The electronic wavefunction is specified via the \keyword{wfn} keyword.
The range of allowed wavefunctions is listed in Table \ref{table:wfn}

\subsection{Geometry Optimization}
\PSIoptking\ is the program responsible for orchestrating the
process of geometry optimization. It can do a number of tasks
automatically, such as generating internal coordinates, produce
empirical force constant matrix, if necessary, update it, and
check if geometry optimization is over. Some or all of the following
files are necessary to perform a geometry optimization with \PSIoptking:
\begin{itemize} 
\item \FILE{11.dat} - contains the cartesian geometry and the nuclear forces, produced by \PSIcderiv ;
\item \fconstdat - contains force constants; if absent - empirical force constants will
be generated by \PSIoptking ;
\item \intcodat - contains internal coordinates in a format readable by a human;
if absent - internal coordinates are generated automatically by \PSIoptking .
\end{itemize}

The procedure for setting up such a calculation is as follows: 
\begin{itemize}
\item define internal coordinates if desired (if unsure - do not)
\item obtain a set of force constants in an fconst.dat file (if unsure - do not) 
\item run a first derivative with the \keyword{opt} flag set to true and \keyword{ nopt} around 5
\end{itemize}
Precision with which geometry is optimized depends on the residual
forces on the nuclei. By default \PSIoptking\ will terminate the job
if the residual cartesian gradients in \FILE{11.dat} are less than
$10^{-5}$ in atomic units. It is probably enough for most
tasks. Going below this will most likely waste CPU
time unless you are doing benchmarks.

An important aspect of a geometry optimization is the accuracy
of the first derivatives of energy that \PSIthree\ computes.
Depending on how poorly your wavefunction has been convereged, the
gradients themselves may not be sufficiently accurate for
the requested convergence criterion. After computing first
derivatives of the energy, \PSIcints\ runs a simple check
of the quality of the energy derivative. It's a good idea to
look at \PSIcints ' output to make sure that the gradients are OK. 

Let us take a look at each step involved in optimizing molecular geometry.

\subsubsection{Internal Coordinates and Structure of \keyword{intco} Vector}
This section is largely obsolete now with the addition of the \PSIoptking\ 
program which can generate internal coordinates automatically. At present
\PSIoptking\ cannot handle molecules larger than a few
atoms but it should change in the immediate future. Hence 
you may still specify internal coordinates manually
as described here, but this ability will become obsolete someday.

\PSIthree\ currently carries out all optimizations in
internal coordinates. The internals are specified in either
\inputdat\ or \intcodat. First, the primitive internals
are defined. These are individual
stretches, bends, torsion, out-of-plane deformations,
and two different linear bends denoted lin1 and lin2.
All of these are defined in Wilson, Decius, and Cross. An example for methane is
below:
\begin{verbatim}
intco: (
   stre = (
     (1 1 2)
     (2 1 3)
     (3 1 4)
     (4 1 5)
   )
   bend = (
     (5 2 1 5)
     (6 3 1 5)
     (7 4 1 5)
     (8 2 1 4)
     (9 3 1 4)
     (10 2 1 3)
   )
\end{verbatim}
After the primitives are defined, they are constructed into
symmetrized internals with the totally symmetric placed in
the SYMM vector and the rest placed in the ASYMM vector. For
optimizations, only the SYMM internals need to be defined.
Likewise, if during an optimization a molecule breaks symmetry,
the internals have been improperly defined. Again, methane is done
below:
\begin{verbatim}
    symm = (
     ("(1) stretch"(1 2 3 4))
   )
    asymm = (
     ("(2) E bend"(10 7))
     ("(3) T2 stretch"(1  2  -3  -4 ))
     ("(4) T2 bend"(10 -7))
     ("(5) E torsion"(8 -5  -9  6))
     ("(6) T2 bend" (8 -6))
     ("(7) T2 bend"( 5 -9))
     ("(8) T2 stretch"(1  3  -2  -4))
     ("(9) T2 stretch"(1  4 -2  -3))
   )
)
\end{verbatim}
The SYMM and ASYMM vectors have two or three components: the first
is a label enclosed by quotation marks and the second is the list
of primitive internals comprising this vector. Some
internals have been multiplied by -1 to reflect the appropriate
symmetries. If the internals need to be weighted by some prefactor,
then a third vector may be used: 
\begin{verbatim}
    symm = (
     ("generic coord" (1 -2 -3) (2.0 1.0 1.0))
   )
\end{verbatim}
For more information in defining symmetric internals, refer to Cotton's text.

\subsubsection{Force Constant Matrix and Structure of \fconstdat}
The quality of the force constants, or Hessian, is critical for
optimizing weakly bound structures. In order to start an optimization,
one needs the \fconstdat\ file. For those of you that can speak
Fortran 77, this file is written in 8F10.7 format. It is the
lower triangle of the force constant matrix in internal coordinates. The order
of the forces is identical to the order of the SYMM and ASYMM vectors.
For the methane-water dimer, an excerpt from a real \fconstdat\ is shown below: 
\begin{verbatim}
  5.654908
   .217027  5.616085
  -.006096  -.001145  6.078154
  -.055291   .026921   .023732   .317485
   .004063  -.155489  -.003880  -.170201   .873999
  -.146900  -.285108   .001153  -.023346   .196008   .605239
   .001037  -.001959   .002945  -.024597   .014432   .005302   .388622
\end{verbatim}
Ideally, your diagonal elements should be the much larger than
the non-diagonal elements. If you need an \fconstdat\ file, you have four options: 
\begin{enumerate}
\item Create a diagonal matrix of 1's 
\item Create a diagonal matrix with 5 for stretching coordinates,
2 for bending coordinates, and 1 for all other coordinates 
\item Let \PSIoptking\ generate an empirical Hessian for you
\item Run a second derivative to obtain a Cartesian Hessian
and transform that to internals( fconst.dat) with intder. 
\end{enumerate}
Clearly, the list starts at the most
approximate and gets more accurate. 

\subsection{Frequency Analysis}
Currently, analytic second derivatives are not avaliable for any
method in \PSIthree. Hence, for methods with analytic gradients,
one must carry out finite difference calculations. If one has the misfortune of needing frequencies
for methods where only energies exist(e.g. FCI or MP2-R12), finite
differences with gradients approximated by energy
points must be used. There are two types of frequency analysis
programs available within \PSIthree, \PSInormco\ and \PSIintder.
For more details regarding these programs, see the manual pages for each
program respectively.

\subsection{Property evaluation}
For now, take a look at the available documentation for \PSIoeprop .

\subsection{Utilities}
\subsubsection{\PSIgeom}
The program \PSIgeom\ reads a set of Cartesian coordinates
and determines from them the bond distances (Bohr and
angstrom), bond angles, torsional angles, out-of-plane
angles (optional), moments of inertia, and rotational constants.
It requires either a \FILE{11.dat} or \geomdat\ and writes \geomout. 
