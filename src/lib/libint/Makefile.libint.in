include @top_objdir@/src/lib/MakeVars
include @top_objdir@/src/lib/libint/MakeVars

VPATH = .:$(top_srcdir)/src/lib/libint
TARGET = $(top_objdir)/lib/libPSI_int.a
HEADERS = libint.h vrr_header.h hrr_header.h

#
# List all generated routines. Do it in a safe way in case the list is too long
#
TRUESRC1 = $(shell echo `ls vrr_order_*.cc`)
TRUESRC2 = $(shell echo `ls hrr_order_*.cc`)
TRUESRC3 = $(shell echo `ls build_*.cc`)
TRUESRC4 = $(shell echo `ls hrr[1,3]_build_*.cc`)
TRUESRC5 = $(LIB_SRC)
TRUESRC6 = init_libint.cc
LIBOBJ1 = $(TRUESRC1:%.cc=%.o)
LIBOBJ2 = $(TRUESRC2:%.cc=%.o)
LIBOBJ3 = $(TRUESRC3:%.cc=%.o)
LIBOBJ4 = $(TRUESRC4:%.cc=%.o)
LIBOBJ5 = $(TRUESRC5:%.c=%.o)
LIBOBJ6 = $(TRUESRC6:%.cc=%.o)
LIBOBJ = $(LIBOBJ1) $(LIBOBJ2) $(LIBOBJ3) $(LIBOBJ4) $(LIBOBJ5) $(LIBOBJ6)

#
# List all routines generated as header files too
#
INCSRC1 = $(shell echo `ls build_*.h`)
INCSRC2 = $(shell echo `ls hrr[1,3]_*.h`)
INCSRC = $(INCSRC1) $(INCSRC2)

default:: install

%.$(OBJSUF): %.c
	$(CC) $(CFLAGS) -c $< $(OUTPUT_OPTION)

%.$(OBJSUF): %.cc
	$(CXX) $(CXXFLAGS) -c $< $(OUTPUT_OPTION)

#
# do installations
#

install:: install_inc install_target install_man

$(TARGET): $(LIBOBJ)
	$(MKDIRS) `dirname $(TARGET)`
	rm -f `basename $(TARGET)`
	$(AR) $(ARFLAGS) `basename $(TARGET)` $(LIBOBJ1)
	$(AR) $(ARFLAGS) `basename $(TARGET)` $(LIBOBJ2)
	$(AR) $(ARFLAGS) `basename $(TARGET)` $(LIBOBJ3)
	$(AR) $(ARFLAGS) `basename $(TARGET)` $(LIBOBJ4)
	$(AR) $(ARFLAGS) `basename $(TARGET)` $(LIBOBJ5)
	$(AR) $(ARFLAGS) `basename $(TARGET)` $(LIBOBJ6)
	$(RANLIB) `basename $(TARGET)`

install_target:: $(TARGET)
	$(MKDIRS) $(libdir)
	$(INSTALL_DATA) `basename $<` $(libdir)
	$(RANLIB) $(libdir)/`basename $(TARGET)`

install_man::


install_inc:: install_inc1 install_inc2

install_inc1:: $(HEADERS)
	$(MKDIRS) $(objincdir)
	$(INSTALL_INCLUDE) $^ $(objincdir)

install_inc2:: $(INCSRC)
	$(MKDIRS) $(objincdir)/libint
	$(INSTALL_INCLUDE) $^ $(objincdir)/libint

#
# clean up
#

clean:: iclean oclean dclean targetclean

iclean:
	-rm -f *.gbl *.lcl

oclean:
	-rm -f *.o

dclean:
	-rm -f *.d

targetclean:
	-rm -f `basename $(TARGET)`
